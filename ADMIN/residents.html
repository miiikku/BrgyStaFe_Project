<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Residents</title>
    <link href="https://fonts.googleapis.com/css2?family=Arial:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="public/admin/resident.css">
</head>
<body>
    <div class="sidebar">
        <div>
            <center>
                <img src="https://www.dropbox.com/scl/fi/hplpyx3p3gjc3ozhxa7w6/Dasmarinas-removebg-preview.png?rlkey=bw11d1gi5odcv59ingug5pjeh&st=tl9dj1dk&dl=1" class="Logo">
                <h1>BARANGAY SANTA FE<br>CITY OF DASMARIÑAS</h1>
            </center>
            <div class="sidenav">
                <ul>
                    <li><a href="dashboard.html" class="sidebar-link"><img src="https://www.dropbox.com/scl/fi/es7o8fr6dw2vkkywjpg66/dashboard.png?rlkey=pp0dy252j9wao81jpz1n50f4p&st=83lbnbnz&dl=1" class="sidebar-icon">Dashboard</a></li>
                    <li><a href="notification.html" class="sidebar-link"><img src="https://www.dropbox.com/scl/fi/te9qkrjtunarm8znvfs1w/notification.png?rlkey=kqzy50yimgtro1l8caiqnqbua&st=4zuvr1p0&dl=1" class="sidebar-icon">Notification</a></li>
                    <li><a href="user-account.html" class="sidebar-link"><img src="https://www.dropbox.com/scl/fi/tnounxbo8vd5763gnoysp/userAccount.png?rlkey=hyos7zrh4ghwr66mjivsqfd5b&st=4ko3y2wy&dl=1" class="sidebar-icon">User Account</a></li>
                    <li><a href="residents.html" class="sidebar-link"><img src="https://www.dropbox.com/scl/fi/e57yqafcdt0z58wbgvv9e/residents.png?rlkey=wcqigcrhwveax3qubldx0qaql&st=np6th3hf&dl=1" class="sidebar-icon">Residents</a></li>
                    <li><a href="complaints.html" class="sidebar-link"><img src="https://www.dropbox.com/scl/fi/kbs0xnrc9usw40lv30clw/scales-of-justice.png?rlkey=d36ewu4dge121egpw53qri8mf&st=r04p7f12&dl=1" class="sidebar-icon">Complaints</a></li>
                    <li><a href="barangay-id.html" class="sidebar-link"><img src="https://www.dropbox.com/scl/fi/5bv5aqyto4z9york6lzwq/id-card.png?rlkey=crbfg36zcmb1tq9yfdg0t8zm2&st=ocm8u8fd&dl=1" class="sidebar-icon">Barangay ID</a></li>
                    <li><a href="request.html" class="sidebar-link"><img src="https://www.dropbox.com/scl/fi/idqomcr0ujnsmd54ktpu5/quote-request.png?rlkey=swquji94hs61jlr8y0p992s0n&st=vkr8y4i7&dl=1" class="sidebar-icon">Requests</a></li>
                    <li><a href="module.html" class="sidebar-link"><img src="https://www.dropbox.com/scl/fi/olqdewf6h2pi148jw0j2p/maintenance.png?rlkey=5rnv8iajpbytp799jgyvs6cqa&st=9qpfgd82&dl=1" class="sidebar-icon">Maintenance</a></li>
                </ul>
            </div>
        </div>
    </div>
    <div class="main-content">
        <div class="header">
            <h2>Residents</h2>
            <div class="user-info">
                <div class="dropdown">
                    <img src="https://www.dropbox.com/scl/fi/oedqyjb59kspzdylesk6y/user.png?rlkey=1axl685fxswp7olj90dbgu53y&st=7jh50r8n&dl=1" alt="User Avatar" class="dropbtn" onclick="toggleDropdown()">
                    <div id="myDropdown" class="dropdown-content">
                        <a href="admin-details.html" onclick="viewProfile()">User Profile</a>
                        <a href="module.html">Maintenance</a>
                        <a href="#" onclick="logout()">Logout</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="search-and-actions">
            <div class="search-box">
                <input type="text" placeholder="Search..." oninput="searchResidents()">
            </div>
            <div class="account-actions">
            <button class="add-btn" onclick="openModal()">Add</button>
            <!-- Modal -->
            <div id="addModal" class="modal">
                <div class="modal-content">
                    <span class="close" onclick="closeModal()">&times;</span>
                    <form id="addForm">
                        <h2>ADD RESIDENT</h2>
                        
                        <!-- Row 1: File Input -->
                        <div class="form-row file-input">
                            <input type="file" id="photo" name="photo" accept="image/*">
                        </div>
                        
                        <!-- Row 2: Name (First, Middle, Last) -->
                        <div class="form-row name-fields">
                            <div class="floating-label">
                                <input type="text" id="addFirstname" name="firstname" placeholder=" " required>
                                <label for="addFirstname">First Name</label>
                            </div>
                            <div class="floating-label">
                                <input type="text" id="addMiddlename" name="middlename" placeholder=" " required>
                                <label for="addMiddlename">Middle Name</label>
                            </div>
                            <div class="floating-label">
                                <input type="text" id="addLastname" name="lastname" placeholder=" " required>
                                <label for="addLastname">Last Name</label>
                            </div>
                        </div>
                        

                        <!-- Row 3: Age, Gender, Birthdate, Civil Status -->
                        <div class="form-row">
                            <div class="floating-label">
                                <input type="text" id="addAge" name="age" placeholder=" " readonly>
                                <label for="addAge">Age</label>
                            </div>
                            <div class="floating-label">
                                <select id="addGender" name="gender" required>
                                    <option value="" disabled selected></option>
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                </select>
                                <label for="addGender">Gender</label>
                            </div>
                            <div class="floating-label">
                                <input type="date" id="addBirthdate" name="birthdate" placeholder=" " required>
                                <label for="addBirthdate">Birthdate</label>
                            </div>
                            <div class="floating-label">
                                <select id="addCivilStatus" name="civilstatus" required>
                                    <option value="" disabled selected></option>
                                    <option value="Single">Single</option>
                                    <option value="Married">Married</option>
                                    <option value="Widowed">Widowed</option>
                                </select>
                                <label for="addCivilStatus">Civil Status</label>
                            </div>
                        </div>

                        <!-- Row 4: PWD/Senior, Voter Status, Years Residing -->
                        <div class="form-row">
                            <div class="floating-label">
                                <select id="addPwdSenior" name="pwd_senior" required>
                                    <option value="" disabled selected></option>
                                    <option value="N/A">N/A</option>
                                    <option value="PWD">PWD</option>
                                    <option value="Senior">Senior</option>
                                </select>
                                <label for="addPwdSenior">PWD/Senior</label>
                            </div>
                            <div class="floating-label">
                                <select id="addVoterStatus" name="voter_status" required>
                                    <option value="" disabled selected></option>
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                </select>
                                <label for="addVoterStatus">Voter Status</label>
                            </div>
                            <div class="floating-label">
                                <input type="text" id="addContactNumber" name="contact_number" placeholder=" " required>
                                <label for="addContactNumber">Contact #</label>
                            </div>
                            <div class="floating-label">
                                <input type="date" id="addStartDate" name="startDate" placeholder=" " required>
                                <label for="addStartDate">Start Date</label>
                            </div>                            
                            <div class="floating-label">
                                <input type="number" id="addYearsResiding" name="yearsresiding" placeholder=" " readonly>
                                <label for="addYearsResiding">Years Residing</label>
                            </div>
                            
                        </div>

                        <!-- Row 5: Address -->
                        <div class="form-row">
                            <div class="floating-label">
                                <input type="text" id="addBlk" name="blk" placeholder=" " required>
                                <label for="addBlk">Blk</label>
                            </div>
                            <div class="floating-label">
                                <input type="text" id="addLot" name="lot" placeholder=" " required>
                                <label for="addLot">Lot No.</label>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="floating-label">
                                <input type="text" id="addStreet" name="street" placeholder=" " required>
                                <label for="addStreet">Street</label>
                            </div>
                            <div class="floating-label">
                                <input type="text" id="addBarangay" name="barangay" placeholder=" " value="Santa Fe" readonly required>
                                <label for="addBarangay">Barangay</label>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="floating-label">
                                <input type="text" id="addCity" name="city" placeholder=" " value="Dasmariñas" readonly required>
                                <label for="addCity">City</label>
                            </div>
                            <div class="floating-label">
                                <input type="text" id="addProvince" name="province" placeholder=" " value="Cavite" readonly required>
                                <label for="addProvince">Province</label>
                            </div>
                        </div>
                        

                        <!-- Add Email Input to the Modal Form -->
                        <div class="form-row">
                            <div class="floating-label full-width">
                                <input type="email" id="addEmail" name="email" placeholder=" ">
                                <label for="addEmail">Email</label>
                        
                            </div>
                        </div>


                        <!-- Buttons -->
                        <div class="button-container">
                            <button type="submit" class="add-btn">Add</button>
                            <button type="button" class="cancel-btn" onclick="closeModal()">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>
 
        </div>
    </div>
    <div class="account-content">
        <h3>Resident Information</h3>
        <div class="account-table">
                <div class="scrollable-table" style="max-height: 500px; overflow-y: auto; overflow-x: hidden;">
                <table>
                    <thead>
                        <tr>
                            <th>Picture</th>
                            <th>Name</th>
                            <th>Birthdate</th>
                            <th>Age</th>
                            <th>Gender</th>
                            <th>Civil Status</th>
                            <th>PWD/Senior</th>
                            <th>Voter Status</th>
                            <th>Contact #</th>
                            <th>Email</th>
                            <th>Address</th>
                            <th>Years Residing</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="resident-table-body">
                        <!-- Rows will be dynamically inserted here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    

    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEditModal()">&times;</span>
            <form id="editForm">
                <h2>EDIT RESIDENT</h2>
                <div class="form-row">
                    <input type="file" id="editPhoto" name="photo" accept="image/*">
                </div>
                <div class="floating-label">
                    <input type="text" id="editFirstname" name="firstname" placeholder=" " required>
                    <label for="editFirstname">First Name</label>
                </div>
                <div class="floating-label">
                    <input type="text" id="editMiddlename" name="middlename" placeholder=" " required>
                    <label for="editMiddlename">Middle Name</label>
                </div>
                <div class="floating-label">
                    <input type="text" id="editLastname" name="lastname" placeholder=" " required>
                    <label for="editLastname">Last Name</label>
                </div>
                <div class="floating-label">
                    <input type="date" id="editBirthdate" name="birthdate" placeholder=" " required>
                    <label for="editBirthdate">Birthdate</label>
                </div>
                <div class="floating-label">
                    <input type="number" id="editAge" name="age" placeholder=" " readonly>
                    <label for="editAge">Age</label>
                </div>
                <div class="floating-label">
                    <select id="editGender" name="gender" required>
                        <option value="" disabled selected></option>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                    </select>
                    <label for="editGender">Gender</label>
                </div>
                <div class="floating-label">
                    <select id="editCivilStatus" name="civilstatus" required>
                        <option value="" disabled selected></option>
                        <option value="Single">Single</option>
                        <option value="Married">Married</option>
                        <option value="Widowed">Widowed</option>
                    </select>
                    <label for="editCivilStatus">Civil Status</label>
                </div>
                <div class="floating-label">
                    <select id="editPwdSenior" name="pwd_senior" required>
                        <option value="" disabled selected></option>
                        <option value="N/A">N/A</option>
                        <option value="PWD">PWD</option>
                        <option value="Senior">Senior</option>
                    </select>
                    <label for="editPwdSenior">PWD/Senior</label>
                </div>
                <div class="floating-label">
                    <select id="editVoterStatus" name="voter_status" required>
                        <option value="" disabled selected></option>
                        <option value="Yes">Yes</option>
                        <option value="No">No</option>
                    </select>
                    <label for="editVoterStatus">Voter Status</label>
                </div>
                <div class="floating-label">
                    <input type="text" id="editContactNumber" name="contact_number" placeholder=" " required>
                    <label for="editContactNumber">Contact #</label>
                </div>
                <div class="form-row">
                    <div class="floating-label">
                        <input type="text" id="editBlk" name="blk" placeholder=" " required>
                        <label for="editBlk">Blk</label>
                    </div>
                    <div class="floating-label">
                        <input type="text" id="editLot" name="lot" placeholder=" " required>
                        <label for="editLot">Lot No.</label>
                    </div>
                </div>
                <div class="form-row">
                    <div class="floating-label">
                        <input type="text" id="editStreet" name="street" placeholder=" " required>
                        <label for="editStreet">Street</label>
                    </div>
                    <div class="floating-label">
                        <input type="text" id="editBarangay" name="barangay" placeholder=" " value="Santa Fe" readonly required>
                        <label for="editBarangay">Barangay</label>
                    </div>
                </div>
                <div class="form-row">
                    <div class="floating-label">
                        <input type="text" id="editCity" name="city" placeholder=" " value="Dasmariñas" readonly required>
                        <label for="editCity">City</label>
                    </div>
                    <div class="floating-label">
                        <input type="text" id="editProvince" name="province" placeholder=" " value="Cavite" readonly required>
                        <label for="editProvince">Province</label>
                    </div>
                </div>
                
                <div class="floating-label">
                    <input type="email" id="editEmail" name="email" placeholder=" ">
                    <label for="editEmail">Email</label>
                </div>
                <div class="floating-label">
                    <input type="date" id="editStartDate" name="startDate" placeholder=" " required>
                    <label for="editStartDate">Start Date</label>
                </div>                
                <div class="floating-label">
                    <input type="number" id="editYearsResiding" name="yearsresiding" placeholder=" " readonly>
                    <label for="editYearsResiding">Years Residing</label>
                </div>
                <div class="button-container">
                    <button type="submit" class="add-btn">Save</button>
                    <button type="button" class="cancel-btn" onclick="closeEditModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>
    
    <script src="public/styles/script.js"></script>
    <script src="/public/js/sessionTimeout.js"></script>
        <script>

            // SEARCH
            function searchResidents() {

                // Get the search input value
                const searchValue = document.querySelector('.search-box input').value.toLowerCase();

                // Get the table rows
                const rows = document.querySelectorAll('#resident-table-body tr');

                // Loop through all rows and hide those that don't match the search query
                rows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    const matches = Array.from(cells).some(cell => 
                        cell.textContent.toLowerCase().includes(searchValue)
                    );

                    if (matches) {
                        row.style.display = ''; // Show the row
                    } else {
                        row.style.display = 'none'; // Hide the row
                    }
                });
            }

            // CALCULATE AGE NAG IINCREMENT EACH YEAR
            function calculateAge(birthdate) {
    const today = new Date();  // Get the current date
    const birthDate = new Date(birthdate);  // Convert birthdate to Date object
    let age = today.getFullYear() - birthDate.getFullYear();  // Calculate the difference in years
    const monthDiff = today.getMonth() - birthDate.getMonth();  // Calculate the difference in months

    // If the current month is earlier than the birth month or it's the birth month but the day hasn't come yet, subtract one year
    if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
        age--;
    }
    return age;
}

function updateResidentAge() {
    // Assuming you have an array of residents data (with birthdates) or fetch it from an API
    fetch('/residents')  // Example of fetching resident data
        .then(response => response.json())
        .then(residents => {
            // Loop through each resident and update their age dynamically
            residents.forEach(resident => {
                const age = calculateAge(resident.birthdate);  // Calculate age based on their birthdate
                
                // Assuming each resident is in a row and you want to display the age in a specific table column
                const ageElement = document.getElementById(`age-${resident._id}`);  // Assuming you have an element with id age-residentId
                if (ageElement) {
                    ageElement.textContent = age;  // Update the text content of the age element
                }
            });
        })
        .catch(error => console.error('Error fetching residents:', error));
}

// Call the updateResidentAge function when the page loads
document.addEventListener('DOMContentLoaded', function () {
    updateResidentAge();  // Recalculate and update the age for all residents
});

// CALCULATE AGE SA EDIT
document.getElementById('editBirthdate').addEventListener('change', function () {
    const birthdate = this.value;
    const age = calculateAge(birthdate);
    document.getElementById('editAge').value = age;
});

// YEARS RESIDING INCREMENT EACH YEAR
function calculateYearsResiding(startDate) {
    const today = new Date();
    const start = new Date(startDate);

    let yearsResiding = today.getFullYear() - start.getFullYear();
    const monthDiff = today.getMonth() - start.getMonth();
    const dayDiff = today.getDate() - start.getDate();

    // Check if the current month and day are earlier than the start date month and day
    if (monthDiff < 0 || (monthDiff === 0 && dayDiff < 0)) {
        yearsResiding--;
    }

    return yearsResiding;
}


// Add this code for Start Date -> Years Residing calculation
document.getElementById('addStartDate').addEventListener('change', function() {
    const startDate = this.value;
    const yearsResiding = calculateYearsResiding(startDate);
    document.getElementById('addYearsResiding').value = yearsResiding;
});

    //EDIT START DATE
    document.getElementById('editStartDate').addEventListener('change', function() {
    const startDate = this.value;
    const yearsResiding = calculateYearsResiding(startDate);
    document.getElementById('editYearsResiding').value = yearsResiding;
});




// Automatically update age when birthdate is entered
document.getElementById('addBirthdate').addEventListener('change', function () {
    const birthdate = this.value;
    const age = calculateAge(birthdate);
    document.getElementById('addAge').value = age;
});


            // Add Modal
            function openModal() {
                document.getElementById("addModal").style.display = "block";
            }

            function closeModal() {
                document.getElementById("addModal").style.display = "none";
            }

            function openEditModal(id) {
    fetch(`/residents/${id}`)
        .then(response => response.json())
        .then(resident => {
            console.log(resident);  // Debugging to verify the data structure
            
            // Set field values only if the elements exist
            if (document.getElementById('editFirstname')) {
                document.getElementById('editFirstname').value = resident.Firstname || '';
            }
            if (document.getElementById('editMiddlename')) {
                document.getElementById('editMiddlename').value = resident.Middlename || '';
            }
            if (document.getElementById('editLastname')) {
                document.getElementById('editLastname').value = resident.Lastname || '';
            }
            if (document.getElementById('editBirthdate')) {
                document.getElementById('editBirthdate').value = resident.birthdate || '';
            }
            if (document.getElementById('editAge')) {
                document.getElementById('editAge').value = resident.age || '';
            }
            if (document.getElementById('editGender')) {
                document.getElementById('editGender').value = resident.gender || '';
            }
            if (document.getElementById('editCivilStatus')) {
                document.getElementById('editCivilStatus').value = resident.civilstatus || '';
            }
            if (document.getElementById('editPwdSenior')) {
                document.getElementById('editPwdSenior').value = resident["PWD/Senior"] || 'N/A';
            }
            if (document.getElementById('editVoterStatus')) {
                document.getElementById('editVoterStatus').value = resident["Voter Status"] || '';
            }
            if (document.getElementById('editContactNumber')) {
             document.getElementById('editContactNumber').value = resident["Contact Number"] || '';
            }
            if (resident.Address) {
    const addressParts = resident.Address.split(', ');
    if (addressParts.length >= 6) {
        document.getElementById('editBlk').value = addressParts[0].replace('Blk ', '') || '';
        document.getElementById('editLot').value = addressParts[1].replace('Lot ', '') || '';
        document.getElementById('editStreet').value = addressParts[2] || '';
        document.getElementById('editBarangay').value = addressParts[3] || '';
        document.getElementById('editCity').value = addressParts[4] || '';
        document.getElementById('editProvince').value = addressParts[5] || '';
    }
}

            if (document.getElementById('editEmail')) {
                document.getElementById('editEmail').value = resident["e-mail"] || '';
            }
            if (document.getElementById('editYearsResiding')) {
            document.getElementById('editYearsResiding').value = resident.yearsresiding || '';
            }
            if (resident.startDate) {
                document.getElementById('editStartDate').value = new Date(resident.startDate).toISOString().split('T')[0]; // Ensure the date is formatted correctly
            }

            // Store the resident's ID in a hidden input for later use
            let hiddenIdInput = document.getElementById('editResidentId');
            if (!hiddenIdInput) {
                hiddenIdInput = document.createElement('input');
                hiddenIdInput.type = 'hidden';
                hiddenIdInput.id = 'editResidentId';
                document.getElementById('editForm').appendChild(hiddenIdInput);
            }
            hiddenIdInput.value = resident._id;

            document.getElementById("editModal").style.display = "block";
        })
        .catch(error => console.error('Error fetching resident details:', error));
}

            function closeEditModal() {
                document.getElementById("editModal").style.display = "none";
                // Remove the hidden input to avoid duplicates
                const hiddenIdInput = document.getElementById('editResidentId');
                if (hiddenIdInput) {
                    hiddenIdInput.remove();
                }
            }

            function submitEditForm(event) {
    event.preventDefault(); // Prevent the default form submission
    const formData = new FormData(document.getElementById('editForm')); // Use FormData to gather values
    const id = document.getElementById('editResidentId').value; // Get the ID from the hidden input

    // Concatenate the address fields
    const fullAddress = `Blk ${formData.get('blk')}, Lot ${formData.get('lot')}, ${formData.get('street')}, ${formData.get('barangay')}, ${formData.get('city')}, ${formData.get('province')}`;

    const updatedResident = {
        Profilepic: formData.get('photo'),
        Firstname: formData.get('firstname'),
        Middlename: formData.get('middlename'),
        Lastname: formData.get('lastname'),
        birthdate: formData.get('birthdate'),
        age: formData.get('age'),
        gender: formData.get('gender'),
        civilstatus: formData.get('civilstatus'),
        "PWD/Senior": formData.get('pwd_senior'),
        "Voter Status": formData.get('voter_status'),
        "Contact Number": formData.get('contact_number'),
        Address: fullAddress,  // Use the concatenated address
        startDate: formData.get('startDate'),
        yearsresiding: formData.get('yearsresiding'),
        "e-mail": formData.get('email')
    };

    fetch(`/residents/${id}`, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(updatedResident)
    })
    .then(response => {
        if (response.ok) {
            closeEditModal(); // Close the modal
            fetchResidents(); // Refresh the residents table
        } else {
            console.error('Error updating resident:', response.statusText);
        }
    })
    .catch(error => console.error('Error updating resident:', error));
}

                function deleteResident(id) {
    if (confirm("Are you sure you want to delete this resident?")) {
        fetch(`/residents/${id}`, {
            method: 'DELETE'
        })
        .then(response => {
            if (response.ok) {
                fetchResidents(); // Refresh the residents table after deletion
            } else {
                alert('Failed to delete resident');
            }
        })
        .catch(error => {
            console.error('Error deleting resident:', error);
        });
    }
}


            // Fetch Residents
            // On fetch residents
function fetchResidents() {
    fetch('/residents')
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(residents => {
            const tableBody = document.querySelector('#resident-table-body');
            tableBody.innerHTML = ''; // Clear any existing rows

            residents.forEach(resident => {
                const age = calculateAge(resident.birthdate); // Dynamically calculate age
                const yearsResiding = calculateYearsResiding(resident.startDate); // Calculate years residing dynamically
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><img src="${resident.Profilepic}" alt="Picture" class="table-image"></td>
                    <td>${resident.Firstname} ${resident.Middlename} ${resident.Lastname}</td>
                    <td>${resident.birthdate}</td>
                    <td>${age}</td> <!-- Use calculated age -->
                    <td>${resident.gender}</td>
                    <td>${resident.civilstatus}</td>
                    <td>${resident["PWD/Senior"]}</td>
                    <td>${resident["Voter Status"]}</td>
                    <td>${resident["Contact Number"]}</td>
                    <td>${resident["e-mail"]}</td>
                    <td>${resident.Address}</td>
                    <td>${resident.yearsresiding}</td> 
                    <td>
                                    <a href="#"><img src="https://www.dropbox.com/scl/fi/u6i83geituweeaybi8y9w/pen.png?rlkey=5f7vjmsrn42d1t0iaxdu3jbjy&st=0sk8r60h&dl=1" alt="Edit" class="edit-icon" onclick="openEditModal('${resident._id}')"></a>
                                    <a href="#"><img src="https://www.dropbox.com/scl/fi/ho6y40rqr930v22ja9219/delete.png?rlkey=b1xjg0s1v3rnrgjx1n5v2usgm&st=xgbxk20f&dl=1" alt="Delete" class="delete-icon" onclick="deleteResident('${resident._id}')"></a>
                                    <a href="resident-details.html?id=${resident._id}"><img src="https://www.dropbox.com/scl/fi/htv0k6jfdgwb5jd1j5chz/right-arrow.png?rlkey=9vigkl2f1vzdq86892hruea3d&st=s63pgtou&dl=1" alt="Details" class="view-icon"></a>
                                </td>
                `;
                tableBody.appendChild(row);
            });
        })
        .catch(error => console.error('Error fetching residents:', error));
}
            document.addEventListener('DOMContentLoaded', function() {
                document.getElementById('addForm').addEventListener('submit', submitAddForm);
                document.getElementById('editForm').addEventListener('submit', submitEditForm);
                fetchResidents(); // Fetch and display residents on page load
            });

            function submitAddForm(event) {
    event.preventDefault();
    const formData = new FormData(document.getElementById('addForm'));

    // Concatenate the address fields
    const fullAddress = `Blk ${formData.get('blk')}, Lot ${formData.get('lot')}, ${formData.get('street')}, ${formData.get('barangay')}, ${formData.get('city')}, ${formData.get('province')}`;

    const newResident = {
        Profilepic: formData.get('photo'),
        Firstname: formData.get('firstname'),
        Middlename: formData.get('middlename'),
        Lastname: formData.get('lastname'),
        birthdate: formData.get('birthdate'),
        age: formData.get('age'),
        gender: formData.get('gender'),
        civilstatus: formData.get('civilstatus'),
        "PWD/Senior": formData.get('pwd_senior'),
        "Voter Status": formData.get('voter_status'),
        "Contact Number": formData.get('contact_number'),
        Address: fullAddress,  // Use the concatenated address
        startDate: formData.get('startDate'),
        yearsresiding: formData.get('yearsresiding'),
        "e-mail": formData.get('email')
    };

    fetch('/residents', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(newResident)
    })
    .then(response => {
        if (response.ok) {
            document.querySelector('form').reset(); // Clear the form
            closeModal();
            fetchResidents(); // Refresh the residents table
        } else {
            console.error('Error adding resident:', response.statusText);
        }
    })
    .catch(error => console.error('Error adding resident:', error));
}


            // Close the modal when the user clicks anywhere outside of it
            window.onclick = function(event) {
                if (!event.target.matches('.dropbtn') && !event.target.closest('.modal-content')) {
                    var dropdowns = document.getElementsByClassName("dropdown-content");
                    for (var i = 0; i < dropdowns.length; i++) {
                        var openDropdown = dropdowns[i];
                        if (openDropdown.classList.contains('show')) {
                            openDropdown.classList.remove('show');
                        }
                    }

                    var addModal = document.getElementById("addModal");
                    var editModal = document.getElementById("editModal");
                    if (event.target == addModal) {
                        addModal.style.display = "none";
                    }
                    if (event.target == editModal) {
                        editModal.style.display = "none";
                        const hiddenIdInput = document.getElementById('editResidentId');
                        if (hiddenIdInput) {
                            hiddenIdInput.remove();
                        }
                    }
                }
            }
        </script>
</body>
</html>